---
description: "GitHub 仓库同步脚本工作流文档维护规范"
globs:
  - "sync-groups-v2.sh"
  - "WORKFLOW.md"
alwaysApply: true
priority: 1
---

# 工作流文档维护规范

## 核心原则

**可读性优先**：在 AI 生成代码的时代，代码可读性比以往任何时候都更加重要。人类需要能够快速理解代码的全局结构和执行流程。

## 强制要求

**任何对 `sync-groups-v2.sh` 的修改都必须同步更新 `WORKFLOW.md`**

## 需要更新工作流文档的情况

1. **新增函数**：添加新的函数时，必须在 `WORKFLOW.md` 的相应模块中记录
   - 函数功能说明
   - 调用关系
   - 参数说明

2. **修改函数逻辑**：修改现有函数的核心逻辑时，必须更新工作流文档
   - 更新执行流程
   - 更新数据流图
   - 更新相关说明

3. **新增缓存或数据结构**：添加新的全局变量或缓存时，必须更新
   - 数据结构说明
   - 缓存机制说明
   - 使用场景

4. **修改执行流程**：改变主函数执行顺序或添加新阶段时，必须更新
   - 主要工作流程章节
   - 数据流图
   - 关键流程详解

5. **新增功能模块**：添加新的功能模块时，必须更新
   - 核心模块说明
   - 架构图
   - 模块间关系

## 工作流文档结构要求

`WORKFLOW.md` 必须包含以下章节：

1. **整体架构** - 模块层次和设计原则
2. **主要工作流程** - 完整的执行流程（6个阶段）
3. **核心模块说明** - 所有模块的详细说明
4. **缓存机制** - 所有缓存的设计和使用
5. **错误处理与重试** - 错误处理策略
6. **性能优化策略** - 优化点说明
7. **数据流图** - 数据流转可视化
8. **关键数据结构** - 所有全局变量和数据格式

## AI 辅助开发时的要求

当使用 AI 生成或修改代码时：

1. **明确要求**：明确说明需要更新工作流文档
2. **验证一致性**：生成代码后，验证与工作流文档的一致性
3. **全局视角**：确保 AI 理解整体架构后再生成代码
4. **文档优先**：先更新文档，再实现代码（或同步进行）

## 工作流文档更新检查

修改代码后，必须验证：
- [ ] 已更新 `WORKFLOW.md` 中相关的函数说明
- [ ] 已更新 `WORKFLOW.md` 中的执行流程（如有变更）
- [ ] 已更新 `WORKFLOW.md` 中的数据流图（如有变更）
- [ ] 已更新 `WORKFLOW.md` 中的数据结构说明（如有新增）
- [ ] 已检查工作流文档的准确性（与实际代码一致）

## 参考文档

- `WORKFLOW.md` - 完整的工作流和架构文档
- `MAINTENANCE-CHECKLIST.md` - 代码修改维护检查清单
- `README.md` - 使用说明

## 重要提醒

**在 AI 时代，代码生成速度很快，但理解代码的成本在增加。**
**保持工作流文档的及时更新，是确保项目可维护性的关键。**
